version: '2'
services:
  bluetooth-audio:
    env_file: .env
    build: ./bluetooth-audio
    image: balena-sound_bluetooth-audio:latest
    restart: always
    network_mode: host
    privileged: true
    volumes:
      - /var/run/dbus:/host/run/dbus
      - bluetoothcache:/var/cache/bluetooth
      - /run/sound/bluetooth:/var/cache/snapcast
  airplay:
    env_file: .env
    build: ./airplay
    image: balena-sound_airplay:latest
    restart: always
    network_mode: host
    privileged: true
    volumes:
      - /var/run/dbus:/host/run/dbus
      - /run/sound/airplay:/var/cache/snapcast
  spotify:
    env_file: .env
    build: ./spotify
    image: balena-sound_spotify:latest
    restart: always
    network_mode: host
    privileged: true
    volumes:
      - /var/run/dbus:/host/run/dbus
      - spotifycache:/var/cache/raspotify
      - /run/sound/spotify:/var/cache/snapcast
  wukong:
    env_file: .env
    image: xuping/wukong-robot-arm:python3.7
    restart: always
    environment: 
      - LANG=C.UTF-8
    command: ["/usr/bin/python3", "wukong.py"]
    ports: 
      - 5050:5000
    devices: 
      - /dev/snd:/dev/snd
    volumes:
      - ./wukong/.asoundrc:/root/.asoundrc
      - ../wukong:/root/.wukong
      - /run/sound/wukong:/var/cache/snapcast
volumes:
  spotifycache:
  bluetoothcache:
  snapcast:
    driver_opts:
      type: tmpfs
      device: tmpfs
